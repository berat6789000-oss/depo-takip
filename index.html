<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Depo Takip</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Chart.js Library -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif; background: #f5f5f7; color: #1d1d1f; max-width: 100vw; overflow-x: hidden; height: 100vh; }
    body.dark-mode { background: #121212; color: #ffffff; }
    body.dark-mode .app-container { background: #1e1e1e; }
    .app-container { max-width: 100%; margin: 0 auto; background: white; min-height: 100vh; position: relative; box-shadow: 0 0 30px rgba(0,0,0,0.05); }
    @media (min-width: 768px) { .app-container { max-width: 414px; margin: 20px auto; border-radius: 24px; overflow: hidden; height: calc(100vh - 40px); } }
    .theme-toggle { position: absolute; top: 20px; right: 20px; background: rgba(255, 255, 255, 0.2); border: none; border-radius: 50%; width: 40px; height: 40px; color: white; font-size: 18px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s; z-index: 100; }
    .theme-toggle:hover { background: rgba(255, 255, 255, 0.3); transform: rotate(30deg); }
    .theme-tooltip { position: absolute; top: 50px; right: 0; background: #1f2937; color: white; padding: 6px 10px; border-radius: 6px; font-size: 12px; white-space: nowrap; opacity: 0; transition: opacity 0.3s; pointer-events: none; }
    .theme-toggle:hover .theme-tooltip { opacity: 1; }
    .app-header { padding: 24px 16px; background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; text-align: center; position: relative; overflow: hidden; }
    .app-header::before { content: ''; position: absolute; top: -50%; right: -10%; width: 80px; height: 80px; background: rgba(255, 255, 255, 0.1); border-radius: 50%; }
    .app-header::after { content: ''; position: absolute; bottom: -30%; left: -5%; width: 60px; height: 60px; background: rgba(255, 255, 255, 0.08); border-radius: 50%; }
    .header-title { font-size: 28px; font-weight: 800; letter-spacing: -0.5px; text-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 8px; }
    .header-time { font-size: 18px; font-weight: 600; font-family: 'Courier New', monospace; letter-spacing: 1px; opacity: 0.9; }
    .fab-container { position: fixed; bottom: 90px; right: 20px; z-index: 1000; display: flex; flex-direction: column; align-items: center; gap: 15px; }
    .fab { width: 60px; height: 60px; border-radius: 50%; color: white; border: none; display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); }
    .fab-primary { background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); }
    .fab-danger { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); position: relative; }
    .fab:hover { transform: scale(1.1); box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3); }
    .fab-danger:hover { background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%); }
    .fab-label { position: absolute; right: 70px; background: #1f2937; color: white; padding: 6px 12px; border-radius: 8px; font-size: 12px; font-weight: 500; white-space: nowrap; pointer-events: none; opacity: 0; transition: opacity 0.3s; }
    .fab:hover .fab-label { opacity: 1; }
    .fab-danger .fab-label { right: 70px; background: #dc2626; }
    .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; height: 60px; background: white; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #e5e5e7; z-index: 1000; }
    body.dark-mode .bottom-nav { background: #2d2d2d; border-color: #444; }
    .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; color: #8e8e93; text-decoration: none; font-size: 12px; flex: 1; height: 100%; transition: all 0.2s; }
    .nav-item.active { color: #3b82f6; }
    .nav-item i { font-size: 20px; margin-bottom: 4px; }
    .content-area { padding: 16px; padding-bottom: 80px; }
    .screen { display: none; }
    .screen.active { display: block; animation: fadeIn 0.3s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .depo-list { display: flex; flex-direction: column; gap: 12px; }
    .depo-card { background: white; border-radius: 16px; padding: 18px; display: flex; align-items: center; box-shadow: 0 2px 12px rgba(0,0,0,0.05); border: 1px solid #f0f0f0; transition: all 0.3s; cursor: pointer; position: relative; }
    body.dark-mode .depo-card { background: #2d2d2d; border-color: #444; color: white; }
    .depo-card:hover { transform: translateY(-2px); box-shadow: 0 4px 16px rgba(0,0,0,0.08); }
    .depo-card.secili { background: #f0f9ff; border-color: #3b82f6; box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2); }
    .depo-checkbox { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); width: 20px; height: 20px; opacity: 0; z-index: 1; cursor: pointer; }
    .depo-checkbox-indicator { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); width: 20px; height: 20px; border: 2px solid #d1d5db; border-radius: 6px; transition: all 0.2s; pointer-events: none; }
    .depo-checkbox:checked + .depo-checkbox-indicator { background: #3b82f6; border-color: #3b82f6; }
    .depo-checkbox:checked + .depo-checkbox-indicator::after { content: '‚úì'; position: absolute; color: white; font-size: 14px; font-weight: bold; top: 50%; left: 50%; transform: translate(-50%, -50%); }
    .depo-icon { width: 50px; height: 50px; background: linear-gradient(135deg, #93c5fd 0%, #60a5fa 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 16px; color: white; font-size: 22px; margin-left: 25px; }
    .depo-info { flex: 1; }
    .depo-name { font-size: 17px; font-weight: 600; margin-bottom: 4px; }
    .depo-stats { font-size: 14px; color: #8e8e93; display: flex; gap: 12px; }
    .urun-list { display: flex; flex-direction: column; gap: 12px; }
    .urun-card { background: white; border-radius: 16px; padding: 16px; box-shadow: 0 2px 12px rgba(0,0,0,0.05); border: 1px solid #f0f0f0; position: relative; }
    body.dark-mode .urun-card { background: #2d2d2d; border-color: #444; color: white; }
    .urun-card.secili { background: #f0f9ff; border-color: #3b82f6; box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2); }
    .urun-checkbox { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); width: 20px; height: 20px; opacity: 0; z-index: 1; cursor: pointer; }
    .urun-checkbox-indicator { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); width: 20px; height: 20px; border: 2px solid #d1d5db; border-radius: 6px; transition: all 0.2s; pointer-events: none; }
    .urun-checkbox:checked + .urun-checkbox-indicator { background: #3b82f6; border-color: #3b82f6; }
    .urun-checkbox:checked + .urun-checkbox-indicator::after { content: '‚úì'; position: absolute; color: white; font-size: 14px; font-weight: bold; top: 50%; left: 50%; transform: translate(-50%, -50%); }
    .urun-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; margin-left: 25px; }
    .urun-name { font-size: 17px; font-weight: 600; flex: 1; }
    .urun-controls { display: flex; align-items: center; gap: 8px; }
    .quantity-control { display: flex; align-items: center; background: #f5f5f7; border-radius: 10px; overflow: hidden; }
    body.dark-mode .quantity-control { background: #333; }
    .quantity-btn { width: 36px; height: 36px; background: transparent; border: none; font-size: 18px; display: flex; align-items: center; justify-content: center; color: #3b82f6; cursor: pointer; }
    .quantity-input { width: 50px; height: 36px; border: none; background: transparent; text-align: center; font-size: 16px; font-weight: 600; color: #1d1d1f; }
    body.dark-mode .quantity-input { color: white; }
    .kritik-seviye { background-color: #fef2f2; border-left: 4px solid #ef4444; }
    body.dark-mode .kritik-seviye { background-color: #4a1f1f; }
    .normal-seviye { background-color: #f0f9ff; border-left: 4px solid #3b82f6; }
    body.dark-mode .normal-seviye { background-color: #1e3a5f; }
    .kritik-uyari { color: #ef4444; font-size: 12px; margin-top: 4px; display: flex; align-items: center; gap: 4px; }
    .urun-card .kritik-uyari { position: absolute; bottom: 10px; left: 60px; font-size: 11px; opacity: 0.8; }
    .urun-kaldir-btn { width: 36px; height: 36px; border-radius: 10px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; border: none; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s; margin-left: 8px; }
    .urun-kaldir-btn:hover { background: #dc2626; transform: scale(1.05); }
    .search-container { margin-bottom: 20px; }
    .search-bar { width: 100%; padding: 14px 16px; background: #e5e7eb !important; border: 1px solid #d1d5db; border-radius: 12px; font-size: 16px; color: #1d1d1f; }
    body.dark-mode .search-bar { background: #333 !important; color: white; border-color: #555; }
    .search-bar:focus { outline: none; background: #d1d5db !important; border-color: #9ca3af; }
    body.dark-mode .search-bar:focus { background: #444 !important; }
    .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 2000; padding: 20px; }
    .modal-overlay.active { display: flex; animation: fadeIn 0.3s; }
    .modal { background: white; border-radius: 20px; width: 100%; max-width: 400px; max-height: 80vh; overflow-y: auto; box-shadow: 0 10px 40px rgba(0,0,0,0.2); }
    body.dark-mode .modal { background: #2d2d2d; color: white; }
    .modal-header { padding: 24px 24px 16px; border-bottom: 1px solid #e5e5e7; font-size: 20px; font-weight: 600; }
    body.dark-mode .modal-header { border-color: #444; }
    .modal-body { padding: 24px; }
    .modal-footer { padding: 16px 24px; border-top: 1px solid #e5e5e7; display: flex; justify-content: flex-end; gap: 12px; }
    body.dark-mode .modal-footer { border-color: #444; }
    .input-group { margin-bottom: 20px; }
    .input-label { display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500; color: #666; }
    body.dark-mode .input-label { color: #ccc; }
    .input-field { width: 100%; padding: 14px 16px; border: 1px solid #e5e5e7; border-radius: 12px; font-size: 16px; transition: all 0.3s; background: #f9fafb !important; }
    body.dark-mode .input-field { background: #333 !important; color: white; border-color: #555; }
    .input-field:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); background: #ffffff !important; }
    body.dark-mode .input-field:focus { background: #444 !important; }
    .btn { padding: 14px 24px; border-radius: 12px; border: none; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; display: inline-flex; align-items: center; justify-content: center; gap: 8px; }
    .btn-primary { background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; }
    .btn-primary:hover { opacity: 0.9; transform: translateY(-1px); }
    .btn-secondary { background: #f3f4f6; color: #374151; }
    body.dark-mode .btn-secondary { background: #333; color: white; }
    .btn-secondary:hover { background: #e5e7eb; }
    body.dark-mode .btn-secondary:hover { background: #444; }
    .btn-danger { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; }
    .btn-danger:hover { background: #dc2626; }
    .btn-success { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; }
    .btn-success:hover { background: #059669; }
    .notification { position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-20px); background: #1d1d1f; color: white; padding: 12px 24px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.2); z-index: 1001; opacity: 0; transition: all 0.3s; }
    .notification.show { opacity: 1; transform: translateX(-50%) translateY(0); }
    .empty-state { text-align: center; padding: 60px 20px; color: #8e8e93; }
    .empty-icon { font-size: 48px; margin-bottom: 16px; opacity: 0.5; }
    .empty-text { font-size: 16px; margin-bottom: 8px; }
    .gecmis-ekrani { background: white; border-radius: 16px; padding: 20px; margin-top: 20px; box-shadow: 0 2px 12px rgba(0,0,0,0.05); }
    body.dark-mode .gecmis-ekrani { background: #2d2d2d; border-color: #444; color: white; }
    .gecmis-item { padding: 12px 0; border-bottom: 1px solid #f0f0f0; }
    body.dark-mode .gecmis-item { border-color: #444; }
    .gecmis-item:last-child { border-bottom: none; }
    .gecmis-tarih { font-size: 14px; color: #8e8e93; margin-bottom: 4px; }
    body.dark-mode .gecmis-tarih { color: #aaa; }
    .gecmis-bilgi { font-size: 16px; font-weight: 500; }
    .rapor-kart { background: white; border-radius: 16px; padding: 20px; box-shadow: 0 2px 12px rgba(0,0,0,0.05); width: 100%; }
    body.dark-mode .rapor-kart { background: #2d2d2d; border-color: #444; color: white; }
    .rapor-baslik { font-size: 18px; font-weight: 600; margin-bottom: 12px; color: #3b82f6; }
    .rapor-deger { font-size: 28px; font-weight: 700; color: #1d1d1f; margin-bottom: 10px; }
    body.dark-mode .rapor-deger { color: white; }
    .rapor-list { list-style: none; margin-top: 12px; }
    .rapor-list li { padding: 8px 0; border-bottom: 1px solid #f0f0f0; }
    body.dark-mode .rapor-list li { border-color: #444; }
    .rapor-list li:last-child { border-bottom: none; }
    .secim-modu-bildirim { position: fixed; top: 80px; left: 50%; transform: translateX(-50%); background: #3b82f6; color: white; padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: 500; z-index: 999; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3); display: none; }
    .secim-modu-bildirim.show { display: block; animation: slideDown 0.3s ease; }
    @keyframes slideDown { from { opacity: 0; transform: translateX(-50%) translateY(-20px); } to { opacity: 1; transform: translateX(-50%) translateY(0); } }
    .tab-container { display: flex; gap: 8px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 8px; }
    .tab-btn { padding: 10px 16px; background: white; border: 1px solid #e5e7eb; border-radius: 10px; font-size: 14px; font-weight: 500; cursor: pointer; white-space: nowrap; transition: all 0.3s; }
    body.dark-mode .tab-btn { background: #2d2d2d; color: white; border-color: #444; }
    .tab-btn.active { background: #3b82f6; color: white; border-color: #3b82f6; }
    .tab-btn:hover:not(.active) { background: #f3f4f6; }
    body.dark-mode .tab-btn:hover:not(.active) { background: #444; }
    .tab-content { display: flex; flex-direction: column; gap: 16px; }
    .tab-content.active { display: flex; }
    .grafik-konteyner { min-height: 280px; background: white; border-radius: 16px; padding: 20px; box-shadow: 0 2px 12px rgba(0,0,0,0.05); width: 100%; }
    body.dark-mode .grafik-konteyner { background: #2d2d2d; border-color: #444; color: white; }
    .grafik-baslik { font-size: 18px; font-weight: 600; margin-bottom: 16px; color: #3b82f6; display: flex; justify-content: space-between; align-items: center; }
    .grafik-filtre { display: flex; gap: 8px; margin-bottom: 16px; }
    .filtre-btn { padding: 6px 12px; border: 1px solid #e5e7eb; background: white; border-radius: 8px; font-size: 14px; cursor: pointer; transition: all 0.3s; }
    body.dark-mode .filtre-btn { background: #333; color: white; border-color: #555; }
    .filtre-btn.active { background: #3b82f6; color: white; border-color: #3b82f6; }
    .filtre-btn:hover:not(.active) { background: #f3f4f6; }
    body.dark-mode .filtre-btn:hover:not(.active) { background: #444; }
    .chart-container { position: relative; height: 220px; width: 100%; }
  </style>
</head>
<body>
  <div class="app-container">
    <div class="app-header" id="mainHeader">
      <button class="theme-toggle" id="themeToggle" title="Tema Deƒüi≈ütir">
        <i class="fas fa-moon"></i>
        <span class="theme-tooltip">Tema Deƒüi≈ütir</span>
      </button>
      <div class="header-title">Depo Takip Sistemi</div>
      <div class="header-time" id="headerTime">00:00:00</div>
    </div>
    <div class="content-area">
      <div class="screen active" id="depolarScreen">
        <div class="search-container">
          <input type="text" class="search-bar" id="depoArama" placeholder="Depo ara...">
        </div>
        <div class="depo-list" id="depoListesi"></div>
        <div class="empty-state" id="bosDepoState" style="display: none;">
          <div class="empty-icon"><i class="fas fa-warehouse"></i></div>
          <div class="empty-text">Hen√ºz depo eklenmemi≈ü</div>
          <p>Yeni depo eklemek i√ßin + butonuna tƒ±klayƒ±n</p>
        </div>
      </div>
      <div class="screen" id="urunlerScreen">
        <div class="header-back" style="margin-bottom: 20px; display: flex; align-items: center; gap: 12px;">
          <button class="btn btn-secondary" id="backToDepolar" style="padding: 8px 12px;">
            <i class="fas fa-arrow-left"></i>
          </button>
          <h2 id="depoBaslik">Depo Adƒ±</h2>
        </div>
        <div class="search-container">
          <input type="text" class="search-bar" id="urunArama" placeholder="√úr√ºn ara...">
        </div>
        <div class="urun-list" id="urunListesi"></div>
        <div class="empty-state" id="bosUrunState" style="display: none;">
          <div class="empty-icon"><i class="fas fa-box-open"></i></div>
          <div class="empty-text">Bu depoda √ºr√ºn bulunmuyor</div>
          <p>Yeni √ºr√ºn eklemek i√ßin + butonuna tƒ±klayƒ±n</p>
        </div>
      </div>
      <div class="screen" id="gecmisScreen">
        <div class="search-container">
          <input type="text" class="search-bar" id="gecmisArama" placeholder="√úr√ºn adƒ± girin...">
          <button class="btn btn-primary" id="gecmisAraBtn" style="margin-top: 10px; width: 100%;">
            <i class="fas fa-search"></i> Ge√ßmi≈üi Ara
          </button>
        </div>
        <div class="gecmis-ekrani" id="gecmisListesi">
          <p style="text-align: center; color: #8e8e93;">√úr√ºn adƒ± girerek ge√ßmi≈üini g√∂r√ºnt√ºleyin</p>
        </div>
      </div>
      <div class="screen" id="raporlarScreen">
        <div class="tab-container">
          <button class="tab-btn active" data-tab="genel">üìä Genel</button>
          <button class="tab-btn" data-tab="grafikler">üìà Grafikler</button>
        </div>
        <div class="tab-content active" id="tabGenel">
          <div class="rapor-kart">
            <div class="rapor-baslik">üìä Genel ƒ∞statistikler</div>
            <div id="genelIstatistikler">Y√ºkleniyor...</div>
          </div>
          <div class="rapor-kart">
            <div class="rapor-baslik">‚ö†Ô∏è Kritik Seviyede √úr√ºnler</div>
            <div id="kritikUrunler">Y√ºkleniyor...</div>
          </div>
          <div class="rapor-kart">
            <div class="rapor-baslik">üìà En √áok Stoklu √úr√ºnler</div>
            <div id="cokStokluUrunler">Y√ºkleniyor...</div>
          </div>
          <button class="btn btn-primary" id="veriYedekleBtn" style="width: 100%; margin-top: 16px;">
            <i class="fas fa-download"></i> Veri Yedekle
          </button>
          <button class="btn btn-secondary" id="veriGeriYukleBtn" style="width: 100%; margin-top: 10px;">
            <i class="fas fa-upload"></i> Veri Geri Y√ºkle
          </button>
          <button class="btn btn-success" id="yazdirRaporBtn" style="width: 100%; margin-top: 10px;">
            <i class="fas fa-print"></i> Rapor Yazdƒ±r
          </button>
        </div>
        <div class="tab-content" id="tabGrafikler">
          <div class="grafik-konteyner">
            <div class="grafik-baslik">
              <span>üìà Aylƒ±k Stok Deƒüi≈üimi</span>
              <div class="grafik-filtre">
                <button class="filtre-btn active" data-filtre="30">30 G√ºn</button>
                <button class="filtre-btn" data-filtre="60">60 G√ºn</button>
                <button class="filtre-btn" data-filtre="90">90 G√ºn</button>
              </div>
            </div>
            <div class="chart-container">
              <canvas id="stokGrafik"></canvas>
            </div>
          </div>
          <div class="grafik-konteyner">
            <div class="grafik-baslik">
              <span>üìä Depo Bazlƒ± Stok Daƒüƒ±lƒ±mƒ±</span>
            </div>
            <div class="chart-container">
              <canvas id="depoGrafik"></canvas>
            </div>
          </div>
          <div class="grafik-konteyner">
            <div class="grafik-baslik">
              <span>üèÜ En Aktif √úr√ºnler</span>
              <div class="grafik-filtre">
                <button class="filtre-btn active" data-filtre="urun">En √áok Hareket</button>
                <button class="filtre-btn" data-filtre="degisim">En √áok Deƒüi≈üim</button>
              </div>
            </div>
            <div class="chart-container">
              <canvas id="urunGrafik"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="fab-container" id="fabContainer">
      <button class="fab fab-danger" id="fabRemoveBtn" title="Sil">
        <i class="fas fa-trash"></i>
        <span class="fab-label">Se√ßili √ñƒüeleri Sil</span>
      </button>
      <button class="fab fab-primary" id="fabBtn" title="Yeni Ekle">
        <i class="fas fa-plus"></i>
        <span class="fab-label">Yeni Ekle</span>
      </button>
    </div>
    <div class="secim-modu-bildirim" id="secimModuBildirim">
      <i class="fas fa-check-circle"></i> Se√ßim Modu Aktif
    </div>
    <nav class="bottom-nav">
      <a href="#" class="nav-item active" data-screen="depolar">
        <i class="fas fa-warehouse"></i>
        <span>Depolar</span>
      </a>
      <a href="#" class="nav-item" data-screen="urunler">
        <i class="fas fa-boxes"></i>
        <span>√úr√ºnler</span>
      </a>
      <a href="#" class="nav-item" data-screen="gecmis">
        <i class="fas fa-history"></i>
        <span>Ge√ßmi≈ü</span>
      </a>
      <a href="#" class="nav-item" data-screen="raporlar">
        <i class="fas fa-chart-bar"></i>
        <span>Raporlar</span>
      </a>
    </nav>
  </div>
  <div class="modal-overlay" id="depoEkleModal">
    <div class="modal">
      <div class="modal-header">Yeni Depo Ekle</div>
      <div class="modal-body">
        <div class="input-group">
          <label class="input-label">Depo Adƒ±</label>
          <input type="text" class="input-field" id="yeniDepoAdi" placeholder="√ñrn: Ana Depo, ≈ûube Deposu">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="depoEkleIptal">ƒ∞ptal</button>
        <button class="btn btn-primary" id="depoEkleKaydet">Kaydet</button>
      </div>
    </div>
  </div>
  <div class="modal-overlay" id="urunEkleModal">
    <div class="modal">
      <div class="modal-header">Yeni √úr√ºn Ekle</div>
      <div class="modal-body">
        <div class="input-group">
          <label class="input-label">√úr√ºn Adƒ±</label>
          <input type="text" class="input-field" id="yeniUrunAdi" placeholder="√ñrn: Pide Hamuru, Ka≈üar Peyniri">
        </div>
        <div class="input-group">
          <label class="input-label">Ba≈ülangƒ±√ß Miktarƒ±</label>
          <input type="number" class="input-field" id="yeniUrunMiktar" value="0" min="0">
        </div>
        <div class="input-group">
          <label class="input-label">Uyarƒ± Miktarƒ± (Opsiyonel)</label>
          <input type="number" class="input-field" id="yeniUrunUyari" placeholder="Bo≈ü bƒ±rakƒ±lƒ±rsa 1 olarak ayarlanƒ±r" min="0">
          <small style="color: #666; font-size: 12px; margin-top: 4px;">Bu miktarƒ±n altƒ±na d√º≈ü√ºnce kritik uyarƒ±sƒ± verir</small>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="urunEkleIptal">ƒ∞ptal</button>
        <button class="btn btn-primary" id="urunEkleKaydet">Kaydet</button>
      </div>
    </div>
  </div>
  <div class="notification" id="notification"></div>
  <script>
    let urunler = [];
    let aktifDepo = localStorage.getItem("aktifDepo");
    let depolar = JSON.parse(localStorage.getItem("depolar")) || [];
    let secimModu = false;
    let tema = localStorage.getItem("tema") || "acik";
    let grafikler = {};
    let uyariMiktarlari = JSON.parse(localStorage.getItem("uyariMiktarlari")) || {};

    function depoUrunKey(ad) { return `urunListesi_${ad}`; }
    function depoGecmisKey(ad) { return `urunGecmisi_${ad}`; }
    function depoVeriKey(ad) { return `depoVerileri_${ad}`; }
    function depoUyariKey(ad) { return `uyariMiktarlari_${ad}`; }

    function updateDigitalTime() {
      const now = new Date();
      const hours = now.getHours().toString().padStart(2, '0');
      const minutes = now.getMinutes().toString().padStart(2, '0');
      const seconds = now.getSeconds().toString().padStart(2, '0');
      const headerTime = document.getElementById('headerTime');
      if (headerTime) {
        headerTime.textContent = `${hours}:${minutes}:${seconds}`;
      }
    }

    function bildirimGoster(mesaj, sure = 3000, tur = 'success') {
      const notification = document.getElementById('notification');
      notification.textContent = mesaj;
      if (tur === 'error') {
        notification.style.background = '#ef4444';
      } else if (tur === 'warning') {
        notification.style.background = '#f59e0b';
      } else {
        notification.style.background = '#10b981';
      }
      notification.classList.add('show');
      setTimeout(() => {
        notification.classList.remove('show');
      }, sure);
    }

    function temaDegistir() {
      if (tema === "acik") {
        tema = "koyu";
        document.body.classList.add('dark-mode');
        document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i><span class="theme-tooltip">A√ßƒ±k Tema</span>';
      } else {
        tema = "acik";
        document.body.classList.remove('dark-mode');
        document.getElementById('themeToggle').innerHTML = '<i class="fas fa-moon"></i><span class="theme-tooltip">Koyu Tema</span>';
      }
      localStorage.setItem("tema", tema);
    }

    function secimModunuAcKapat() {
      secimModu = !secimModu;
      const fabContainer = document.getElementById('fabContainer');
      const bildirim = document.getElementById('secimModuBildirim');
      if (secimModu) {
        fabContainer.classList.add('open');
        bildirim.classList.add('show');
        bildirimGoster('üîò Se√ßim modu a√ßƒ±ldƒ±. √ñƒüeleri se√ßin ve sil butonuna basƒ±n.', 2000, 'warning');
      } else {
        fabContainer.classList.remove('open');
        bildirim.classList.remove('show');
        temizleSecimleri();
      }
      if (document.getElementById('depolarScreen').classList.contains('active')) {
        depoListesiniGuncelle();
      } else if (document.getElementById('urunlerScreen').classList.contains('active')) {
        urunleriYukle();
      }
    }

    function temizleSecimleri() {
      document.querySelectorAll('.depo-checkbox').forEach(cb => cb.checked = false);
      document.querySelectorAll('.urun-checkbox').forEach(cb => cb.checked = false);
    }

    function depoListesiniGuncelle() {
      const depoListesiElem = document.getElementById('depoListesi');
      const bosDepoState = document.getElementById('bosDepoState');
      if (!depoListesiElem) return;
      depoListesiElem.innerHTML = '';
      if (depolar.length === 0) {
        bosDepoState.style.display = 'block';
        return;
      }
      bosDepoState.style.display = 'none';
      depolar.forEach(depoAd => {
        const depoUrunleri = JSON.parse(localStorage.getItem(depoUrunKey(depoAd)) || "[]");
        const depoVerileri = JSON.parse(localStorage.getItem(depoVeriKey(depoAd)) || "{}");
        let kritikUrunSayisi = 0;
        depoUrunleri.forEach(urunAd => {
          const miktar = depoVerileri[urunAd] || 0;
          const uyariMiktari = getUyariMiktari(depoAd, urunAd);
          if (miktar <= uyariMiktari) {
            kritikUrunSayisi++;
          }
        });
        const depoCard = document.createElement('div');
        depoCard.className = 'depo-card';
        depoCard.setAttribute('data-depo-ad', depoAd);
        depoCard.innerHTML = `
          <input type="checkbox" class="depo-checkbox" id="depo_${depoAd.replace(/\s+/g, '_')}" ${secimModu ? '' : 'style="display: none;"'}>
          <div class="depo-checkbox-indicator"></div>
          <div class="depo-icon">
            <i class="fas fa-warehouse"></i>
          </div>
          <div class="depo-info">
            <div class="depo-name">${depoAd}</div>
            <div class="depo-stats">
              <span><i class="fas fa-box"></i> ${depoUrunleri.length} √ºr√ºn</span>
              ${kritikUrunSayisi > 0 ? `<span style="color: #ef4444;"><i class="fas fa-exclamation-triangle"></i> ${kritikUrunSayisi} kritik</span>` : ''}
            </div>
          </div>
          <div style="color: #8e8e93;">
            <i class="fas fa-chevron-right"></i>
          </div>
        `;
        const checkbox = depoCard.querySelector('.depo-checkbox');
        checkbox.addEventListener('change', function() {
          if (this.checked) {
            depoCard.classList.add('secili');
          } else {
            depoCard.classList.remove('secili');
          }
        });
        depoCard.addEventListener('click', function(e) {
          if (!secimModu) {
            aktifDepo = depoAd;
            localStorage.setItem("aktifDepo", aktifDepo);
            depoAc();
          } else {
            const cb = this.querySelector('.depo-checkbox');
            cb.checked = !cb.checked;
            cb.dispatchEvent(new Event('change'));
          }
        });
        depoListesiElem.appendChild(depoCard);
      });
    }

    function getUyariMiktari(depoAd, urunAd) {
      const uyarilar = JSON.parse(localStorage.getItem(depoUyariKey(depoAd)) || "{}");
      return uyarilar[urunAd] !== undefined ? uyarilar[urunAd] : 1;
    }

    function setUyariMiktari(depoAd, urunAd, miktar) {
      const uyarilar = JSON.parse(localStorage.getItem(depoUyariKey(depoAd)) || "{}");
      uyarilar[urunAd] = miktar;
      localStorage.setItem(depoUyariKey(depoAd), JSON.stringify(uyarilar));
    }

    function depoAc() {
      if (!aktifDepo) return;
      document.getElementById('depoBaslik').textContent = `${aktifDepo} Deposu`;
      ekranDegistir('urunler');
      urunleriYukle();
      secimModu = false;
      document.getElementById('fabContainer').classList.remove('open');
      document.getElementById('secimModuBildirim').classList.remove('show');
    }

    function urunleriYukle() {
      const urunListesiElem = document.getElementById('urunListesi');
      const bosUrunState = document.getElementById('bosUrunState');
      if (!urunListesiElem || !aktifDepo) return;
      urunListesiElem.innerHTML = '';
      urunler = JSON.parse(localStorage.getItem(depoUrunKey(aktifDepo)) || "[]");
      const kayitli = aktiveKayitliObj();
      if (urunler.length === 0) {
        bosUrunState.style.display = 'block';
        return;
      }
      bosUrunState.style.display = 'none';
      urunler.forEach(ad => {
        const miktar = kayitli[ad] || 0;
        const uyariMiktari = getUyariMiktari(aktifDepo, ad);
        const kritikSeviye = miktar <= uyariMiktari;
        const urunCard = document.createElement('div');
        urunCard.className = `urun-card ${kritikSeviye ? 'kritik-seviye' : 'normal-seviye'}`;
        urunCard.setAttribute('data-urun-ad', ad);
        urunCard.innerHTML = `
          <input type="checkbox" class="urun-checkbox" id="urun_${ad.replace(/\s+/g, '_')}" ${secimModu ? '' : 'style="display: none;"'}>
          <div class="urun-checkbox-indicator"></div>
          <div class="urun-header">
            <div class="urun-name">${ad}</div>
            <div class="urun-controls">
              <div class="quantity-control">
                <button class="quantity-btn minus" data-urun-ad="${ad}">
                  <i class="fas fa-minus"></i>
                </button>
                <input type="number" class="quantity-input" value="${miktar}" min="0" data-urun-ad="${ad}">
                <button class="quantity-btn plus" data-urun-ad="${ad}">
                  <i class="fas fa-plus"></i>
                </button>
              </div>
              <button class="urun-kaldir-btn urun-sil-btn" data-urun-ad="${ad}" title="√úr√ºn√º Kaldƒ±r">
                <i class="fas fa-trash-alt"></i>
              </button>
            </div>
          </div>
          ${miktar <= uyariMiktari ? `<div class="kritik-uyari"><i class="fas fa-exclamation-triangle"></i> Kritik seviye: ${uyariMiktari} altƒ±</div>` : ''}
        `;
        const checkbox = urunCard.querySelector('.urun-checkbox');
        checkbox.addEventListener('change', function() {
          if (this.checked) {
            urunCard.classList.add('secili');
          } else {
            urunCard.classList.remove('secili');
          }
        });
        urunCard.addEventListener('click', function(e) {
          if (secimModu && !e.target.closest('.urun-controls')) {
            const cb = this.querySelector('.urun-checkbox');
            if (cb) {
              cb.checked = !cb.checked;
              cb.dispatchEvent(new Event('change'));
            }
          }
        });
        urunListesiElem.appendChild(urunCard);
      });
      attachUrunEventListeners();
    }

    function attachUrunEventListeners() {
      document.querySelectorAll('.quantity-btn.minus').forEach(btn => {
        btn.addEventListener('click', function(e) {
          e.stopPropagation();
          if (!secimModu) {
            const urunAd = this.getAttribute('data-urun-ad');
            miktarDegistir(urunAd, -1);
          }
        });
      });
      document.querySelectorAll('.quantity-btn.plus').forEach(btn => {
        btn.addEventListener('click', function(e) {
          e.stopPropagation();
          if (!secimModu) {
            const urunAd = this.getAttribute('data-urun-ad');
            miktarDegistir(urunAd, 1);
          }
        });
      });
      document.querySelectorAll('.quantity-input').forEach(input => {
        input.addEventListener('change', function() {
          if (!secimModu) {
            const urunAd = this.getAttribute('data-urun-ad');
            const yeniMiktar = parseInt(this.value) || 0;
            if (yeniMiktar >= 0) {
              const kayitli = aktiveKayitliObj();
              const oncekiMiktar = kayitli[urunAd] || 0;
              kayitli[urunAd] = yeniMiktar;
              kaydetAktifKayitliObj(kayitli);
              gecekmiseKaydet(urunAd, oncekiMiktar, yeniMiktar);
              const uyariMiktari = getUyariMiktari(aktifDepo, urunAd);
              if (yeniMiktar <= uyariMiktari) {
                bildirimGoster(`${urunAd} kritik seviyeye ula≈ütƒ±! (${uyariMiktari} altƒ±)`, 3000, 'warning');
              }
              urunleriYukle();
            } else {
              this.value = kayitli[urunAd] || 0;
            }
          }
        });
      });
      document.querySelectorAll('.urun-sil-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
          e.stopPropagation();
          const urunAd = this.getAttribute('data-urun-ad');
          if (secimModu) {
            const card = this.closest('.urun-card');
            const cb = card.querySelector('.urun-checkbox');
            if (cb) {
              cb.checked = !cb.checked;
              cb.dispatchEvent(new Event('change'));
            }
          } else {
            if (confirm(`"${urunAd}" √ºr√ºn√ºn√º silmek istediƒüinize emin misiniz?`)) {
              urunleriSil([urunAd]);
            }
          }
        });
      });
    }

    function seciliOƒüeleriSil() {
      if (!secimModu) {
        secimModunuAcKapat();
        return;
      }
      const aktifEkran = document.querySelector('.screen.active').id;
      if (aktifEkran === 'depolarScreen') {
        const seciliDepolar = Array.from(document.querySelectorAll('.depo-checkbox:checked'))
          .map(cb => {
            const card = cb.closest('.depo-card');
            return card ? card.getAttribute('data-depo-ad') : null;
          })
          .filter(Boolean);
        if (seciliDepolar.length === 0) {
          bildirimGoster('‚ö†Ô∏è L√ºtfen silmek i√ßin depo se√ßin!', 2000, 'warning');
          return;
        }
        if (confirm(`${seciliDepolar.length} depoyu silmek istediƒüinize emin misiniz?\n\nT√ºm √ºr√ºnler kalƒ±cƒ± olarak silinecek!`)) {
          depoSil(seciliDepolar);
          secimModunuAcKapat();
        }
      } else if (aktifEkran === 'urunlerScreen') {
        const seciliUrunler = Array.from(document.querySelectorAll('.urun-checkbox:checked'))
          .map(cb => {
            const card = cb.closest('.urun-card');
            return card ? card.getAttribute('data-urun-ad') : null;
          })
          .filter(Boolean);
        if (seciliUrunler.length === 0) {
          bildirimGoster('‚ö†Ô∏è L√ºtfen silmek i√ßin √ºr√ºn se√ßin!', 2000, 'warning');
          return;
        }
        if (confirm(`${seciliUrunler.length} √ºr√ºn√º silmek istediƒüinize emin misiniz?`)) {
          urunleriSil(seciliUrunler);
          secimModunuAcKapat();
        }
      }
    }

    function aktiveKayitliObj() {
      if (!aktifDepo) return JSON.parse(localStorage.getItem("depoVerileri") || "{}");
      return JSON.parse(localStorage.getItem(depoVeriKey(aktifDepo)) || "{}");
    }

    function aktiveGecmisObj() {
      if (!aktifDepo) return JSON.parse(localStorage.getItem("urunGecmisi") || "{}");
      return JSON.parse(localStorage.getItem(depoGecmisKey(aktifDepo)) || "{}");
    }

    function kaydetAktifKayitliObj(obj) {
      if (!aktifDepo) localStorage.setItem("depoVerileri", JSON.stringify(obj));
      else localStorage.setItem(depoVeriKey(aktifDepo), JSON.stringify(obj));
    }

    function kaydetAktifGecmisObj(obj) {
      if (!aktifDepo) localStorage.setItem("urunGecmisi", JSON.stringify(obj));
      else localStorage.setItem(depoGecmisKey(aktifDepo), JSON.stringify(obj));
    }

    function kaydetUrunListesiAktif() {
      if (!aktifDepo) localStorage.setItem("urunListesi", JSON.stringify(urunler));
      else localStorage.setItem(depoUrunKey(aktifDepo), JSON.stringify(urunler));
    }

    function ekranDegistir(yeniEkran) {
      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
      });
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
      });
      document.getElementById(`${yeniEkran}Screen`).classList.add('active');
      document.querySelector(`[data-screen="${yeniEkran}"]`).classList.add('active');
      secimModu = false;
      document.getElementById('fabContainer').classList.remove('open');
      document.getElementById('secimModuBildirim').classList.remove('show');
      if (yeniEkran === 'depolar') {
        depoListesiniGuncelle();
      } else if (yeniEkran === 'raporlar') {
        raporlariGuncelle();
      }
    }

    function miktarDegistir(urunAd, degisim) {
      const kayitli = aktiveKayitliObj();
      const oncekiMiktar = kayitli[urunAd] || 0;
      const yeniMiktar = Math.max(0, oncekiMiktar + degisim);
      if (yeniMiktar === oncekiMiktar) return;
      kayitli[urunAd] = yeniMiktar;
      kaydetAktifKayitliObj(kayitli);
      gecekmiseKaydet(urunAd, oncekiMiktar, yeniMiktar);
      const uyariMiktari = getUyariMiktari(aktifDepo, urunAd);
      if (yeniMiktar <= uyariMiktari) {
        bildirimGoster(`${urunAd} kritik seviyeye ula≈ütƒ±! (${uyariMiktari} altƒ±)`, 3000, 'warning');
      }
      urunleriYukle();
    }

    function gecekmiseKaydet(urunAd, oncekiMiktar, yeniMiktar) {
      const degisim = yeniMiktar - oncekiMiktar;
      if (degisim === 0) return;
      const now = new Date();
      const tarihStr = `${now.getDate()}/${now.getMonth()+1}/${now.getFullYear()} ${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;
      const urunGecmisi = aktiveGecmisObj();
      urunGecmisi[urunAd] = urunGecmisi[urunAd] || [];
      urunGecmisi[urunAd].push({
        tarih: tarihStr,
        degisim: degisim,
        yeniMiktar: yeniMiktar,
        oncekiMiktar: oncekiMiktar
      });
      if (urunGecmisi[urunAd].length > 50) {
        urunGecmisi[urunAd] = urunGecmisi[urunAd].slice(-50);
      }
      kaydetAktifGecmisObj(urunGecmisi);
    }

    function urunleriSil(urunAdlari) {
      if (!Array.isArray(urunAdlari)) {
        urunAdlari = [urunAdlari];
      }
      const kayitli = aktiveKayitliObj();
      const urunGecmisi = aktiveGecmisObj();
      urunAdlari.forEach(urunAd => {
        urunler = urunler.filter(u => u !== urunAd);
        delete kayitli[urunAd];
        delete urunGecmisi[urunAd];
        const uyarilar = JSON.parse(localStorage.getItem(depoUyariKey(aktifDepo)) || "{}");
        delete uyarilar[urunAd];
        localStorage.setItem(depoUyariKey(aktifDepo), JSON.stringify(uyarilar));
      });
      kaydetAktifKayitliObj(kayitli);
      kaydetAktifGecmisObj(urunGecmisi);
      kaydetUrunListesiAktif();
      urunleriYukle();
      bildirimGoster(`‚úÖ ${urunAdlari.length} √ºr√ºn kaldƒ±rƒ±ldƒ±!`);
    }

    function depoSil(depoAdlari) {
      if (!Array.isArray(depoAdlari)) {
        depoAdlari = [depoAdlari];
      }
      const silinecek = depoAdlari;
      silinecek.forEach(depoAd => {
        depolar = depolar.filter(d => d !== depoAd);
        localStorage.removeItem(depoUrunKey(depoAd));
        localStorage.removeItem(depoVeriKey(depoAd));
        localStorage.removeItem(depoGecmisKey(depoAd));
        localStorage.removeItem(depoUyariKey(depoAd));
        if (aktifDepo === depoAd) {
          aktifDepo = null;
          localStorage.removeItem("aktifDepo");
          ekranDegistir('depolar');
        }
      });
      localStorage.setItem("depolar", JSON.stringify(depolar));
      depoListesiniGuncelle();
      bildirimGoster(`‚úÖ ${silinecek.length} depo silindi!`);
    }

    function raporlariGuncelle() {
      let toplamUrun = 0;
      let toplamMiktar = 0;
      let kritikUrunSayisi = 0;
      depolar.forEach(depoAd => {
        const depoUrunleri = JSON.parse(localStorage.getItem(depoUrunKey(depoAd)) || "[]");
        const depoVerileri = JSON.parse(localStorage.getItem(depoVeriKey(depoAd)) || "{}");
        const depoUyarilari = JSON.parse(localStorage.getItem(depoUyariKey(depoAd)) || "{}");
        toplamUrun += depoUrunleri.length;
        depoUrunleri.forEach(urunAd => {
          const miktar = depoVerileri[urunAd] || 0;
          toplamMiktar += miktar;
          const uyariMiktari = depoUyarilari[urunAd] !== undefined ? depoUyarilari[urunAd] : 1;
          if (miktar <= uyariMiktari) {
            kritikUrunSayisi++;
          }
        });
      });
      document.getElementById('genelIstatistikler').innerHTML = `
        <div class="rapor-deger">${depolar.length} Depo</div>
        <div style="margin-top: 10px; font-size: 16px;">
          <div>üì¶ Toplam √úr√ºn: ${toplamUrun}</div>
          <div>‚öñÔ∏è Toplam Stok: ${toplamMiktar}</div>
          <div>‚ö†Ô∏è Kritik √úr√ºn: ${kritikUrunSayisi}</div>
        </div>
      `;
      let kritikUrunlerHTML = '';
      depolar.forEach(depoAd => {
        const depoUrunleri = JSON.parse(localStorage.getItem(depoUrunKey(depoAd)) || "[]");
        const depoVerileri = JSON.parse(localStorage.getItem(depoVeriKey(depoAd)) || "{}");
        const depoUyarilari = JSON.parse(localStorage.getItem(depoUyariKey(depoAd)) || "{}");
        depoUrunleri.forEach(urunAd => {
          const miktar = depoVerileri[urunAd] || 0;
          const uyariMiktari = depoUyarilari[urunAd] !== undefined ? depoUyarilari[urunAd] : 1;
          if (miktar <= uyariMiktari) {
            kritikUrunlerHTML += `<li>${urunAd} (${depoAd}): ${miktar} adet (Uyarƒ±: ${uyariMiktari})</li>`;
          }
        });
      });
      document.getElementById('kritikUrunler').innerHTML = 
        kritikUrunlerHTML ? `<ul class="rapor-list">${kritikUrunlerHTML}</ul>` : 
        '<p style="color: #8e8e93;">Kritik seviyede √ºr√ºn bulunmuyor.</p>';
      let tumUrunler = [];
      depolar.forEach(depoAd => {
        const depoUrunleri = JSON.parse(localStorage.getItem(depoUrunKey(depoAd)) || "[]");
        const depoVerileri = JSON.parse(localStorage.getItem(depoVeriKey(depoAd)) || "{}");
        depoUrunleri.forEach(urunAd => {
          const miktar = depoVerileri[urunAd] || 0;
          tumUrunler.push({ ad: urunAd, depo: depoAd, miktar: miktar });
        });
      });
      tumUrunler.sort((a, b) => b.miktar - a.miktar);
      let cokStokluHTML = '';
      const top10 = tumUrunler.slice(0, 10);
      top10.forEach((urun, index) => {
        cokStokluHTML += `<li>${index + 1}. ${urun.ad} (${urun.depo}): ${urun.miktar} adet</li>`;
      });
      document.getElementById('cokStokluUrunler').innerHTML = 
        cokStokluHTML ? `<ul class="rapor-list">${cokStokluHTML}</ul>` : 
        '<p style="color: #8e8e93;">√úr√ºn bulunmuyor.</p>';
    }

    function grafikleriCiz() {
      if (grafikler.stokGrafik) grafikler.stokGrafik.destroy();
      if (grafikler.depoGrafik) grafikler.depoGrafik.destroy();
      if (grafikler.urunGrafik) grafikler.urunGrafik.destroy();
      document.getElementById('stokGrafik').height = 250;
      document.getElementById('depoGrafik').height = 250;
      document.getElementById('urunGrafik').height = 250;
      cizStokDegisimGrafik();
      cizDepoStokGrafik();
      cizAktifUrunlerGrafik();
    }

    function cizStokDegisimGrafik() {
      const ctx = document.getElementById('stokGrafik').getContext('2d');
      const gunler = [];
      const bugun = new Date();
      for (let i = 29; i >= 0; i--) {
        const tarih = new Date();
        tarih.setDate(bugun.getDate() - i);
        gunler.push(`${tarih.getDate()}/${tarih.getMonth() + 1}`);
      }
      const veriNoktalari = gunler.map(() => 0);
      depolar.forEach(depoAd => {
        const urunGecmisi = JSON.parse(localStorage.getItem(depoGecmisKey(depoAd)) || "{}");
        Object.keys(urunGecmisi).forEach(urunAd => {
          urunGecmisi[urunAd].forEach(kayit => {
            const kayitTarih = kayit.tarih.split(' ')[0];
            const gunIndex = gunler.indexOf(kayitTarih.slice(0, -5));
            if (gunIndex !== -1) {
              veriNoktalari[gunIndex] += Math.abs(kayit.degisim);
            }
          });
        });
      });
      grafikler.stokGrafik = new Chart(ctx, {
        type: 'line',
        data: {
          labels: gunler,
          datasets: [{
            label: 'G√ºnl√ºk Stok Hareketi',
            data: veriNoktalari,
            borderColor: '#3b82f6',
            backgroundColor: 'rgba(59, 130, 246, 0.1)',
            borderWidth: 2,
            fill: true,
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: true,
              position: 'top'
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: 'Toplam Hareket'
              }
            },
            x: {
              title: {
                display: true,
                text: 'Tarih'
              }
            }
          }
        }
      });
    }

    function cizDepoStokGrafik() {
      const ctx = document.getElementById('depoGrafik').getContext('2d');
      const depoAdlari = [];
      const toplamStoklar = [];
      const kritikStoklar = [];
      depolar.forEach(depoAd => {
        const depoUrunleri = JSON.parse(localStorage.getItem(depoUrunKey(depoAd)) || "[]");
        const depoVerileri = JSON.parse(localStorage.getItem(depoVeriKey(depoAd)) || "{}");
        const depoUyarilari = JSON.parse(localStorage.getItem(depoUyariKey(depoAd)) || "{}");
        let toplam = 0;
        let kritik = 0;
        depoUrunleri.forEach(urunAd => {
          const miktar = depoVerileri[urunAd] || 0;
          toplam += miktar;
          const uyariMiktari = depoUyarilari[urunAd] !== undefined ? depoUyarilari[urunAd] : 1;
          if (miktar <= uyariMiktari) {
            kritik++;
          }
        });
        depoAdlari.push(depoAd);
        toplamStoklar.push(toplam);
        kritikStoklar.push(kritik);
      });
      grafikler.depoGrafik = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: depoAdlari,
          datasets: [
            {
              label: 'Toplam Stok',
              data: toplamStoklar,
              backgroundColor: 'rgba(59, 130, 246, 0.7)',
              borderColor: '#3b82f6',
              borderWidth: 1
            },
            {
              label: 'Kritik √úr√ºnler',
              data: kritikStoklar,
              backgroundColor: 'rgba(239, 68, 68, 0.7)',
              borderColor: '#ef4444',
              borderWidth: 1
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: true,
              position: 'top'
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: 'Miktar'
              }
            }
          }
        }
      });
    }

    function cizAktifUrunlerGrafik() {
      const ctx = document.getElementById('urunGrafik').getContext('2d');
      const urunHareketleri = {};
      depolar.forEach(depoAd => {
        const urunGecmisi = JSON.parse(localStorage.getItem(depoGecmisKey(depoAd)) || "{}");
        Object.keys(urunGecmisi).forEach(urunAd => {
          if (!urunHareketleri[urunAd]) {
            urunHareketleri[urunAd] = {
              hareketSayisi: 0,
              toplamDegisim: 0
            };
          }
          urunGecmisi[urunAd].forEach(kayit => {
            urunHareketleri[urunAd].hareketSayisi++;
            urunHareketleri[urunAd].toplamDegisim += Math.abs(kayit.degisim);
          });
        });
      });
      const enAktifUrunler = Object.entries(urunHareketleri)
        .sort((a, b) => b[1].hareketSayisi - a[1].hareketSayisi)
        .slice(0, 10);
      const urunAdlari = enAktifUrunler.map(u => u[0]);
      const hareketSayilari = enAktifUrunler.map(u => u[1].hareketSayisi);
      const degisimMiktarlari = enAktifUrunler.map(u => u[1].toplamDegisim);
      grafikler.urunGrafik = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: urunAdlari,
          datasets: [
            {
              label: 'Hareket Sayƒ±sƒ±',
              data: hareketSayilari,
              backgroundColor: 'rgba(16, 185, 129, 0.7)',
              borderColor: '#10b981',
              borderWidth: 1,
              yAxisID: 'y'
            },
            {
              label: 'Toplam Deƒüi≈üim',
              data: degisimMiktarlari,
              backgroundColor: 'rgba(139, 92, 246, 0.7)',
              borderColor: '#8b5cf6',
              borderWidth: 1,
              yAxisID: 'y1'
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: true,
              position: 'top'
            }
          },
          scales: {
            y: {
              type: 'linear',
              display: true,
              position: 'left',
              title: {
                display: true,
                text: 'Hareket Sayƒ±sƒ±'
              }
            },
            y1: {
              type: 'linear',
              display: true,
              position: 'right',
              title: {
                display: true,
                text: 'Toplam Deƒüi≈üim'
              },
              grid: {
                drawOnChartArea: false
              }
            }
          }
        }
      });
    }

    document.addEventListener('DOMContentLoaded', function() {
      updateDigitalTime();
      setInterval(updateDigitalTime, 1000);
      if (tema === "koyu") {
        document.body.classList.add('dark-mode');
        document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i><span class="theme-tooltip">A√ßƒ±k Tema</span>';
      }
      document.getElementById('themeToggle').addEventListener('click', temaDegistir);
      depoListesiniGuncelle();
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const tabAdi = this.getAttribute('data-tab');
          document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
            if (content.id === `tab${tabAdi.charAt(0).toUpperCase() + tabAdi.slice(1)}`) {
              content.classList.add('active');
              if (tabAdi === 'grafikler') {
                setTimeout(() => {
                  grafikleriCiz();
                }, 100);
              }
            }
          });
        });
      });
      document.querySelectorAll('.filtre-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          this.parentElement.querySelectorAll('.filtre-btn').forEach(b => {
            b.classList.remove('active');
          });
          this.classList.add('active');
          if (document.querySelector('.tab-btn.active').getAttribute('data-tab') === 'grafikler') {
            grafikleriCiz();
          }
        });
      });
      document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', function(e) {
          e.preventDefault();
          const screen = this.getAttribute('data-screen');
          ekranDegistir(screen);
        });
      });
      document.getElementById('fabBtn').addEventListener('click', function() {
        if (secimModu) {
          secimModunuAcKapat();
        } else {
          const aktifEkran = document.querySelector('.screen.active').id;
          if (aktifEkran === 'depolarScreen') {
            document.getElementById('depoEkleModal').classList.add('active');
            document.getElementById('yeniDepoAdi').focus();
          } else if (aktifEkran === 'urunlerScreen' && aktifDepo) {
            document.getElementById('urunEkleModal').classList.add('active');
            document.getElementById('yeniUrunAdi').focus();
          }
        }
      });
      document.getElementById('fabRemoveBtn').addEventListener('click', function() {
        if (!secimModu) {
          secimModunuAcKapat();
        } else {
          seciliOƒüeleriSil();
        }
      });
      document.getElementById('backToDepolar').addEventListener('click', function() {
        ekranDegistir('depolar');
      });
      document.getElementById('depoEkleIptal').addEventListener('click', function() {
        document.getElementById('depoEkleModal').classList.remove('active');
      });
      document.getElementById('depoEkleKaydet').addEventListener('click', function() {
        const depoAdi = document.getElementById('yeniDepoAdi').value.trim();
        if (!depoAdi) {
          bildirimGoster('‚ö†Ô∏è Depo adƒ± gerekli!', 3000, 'error');
          return;
        }
        if (depolar.includes(depoAdi)) {
          bildirimGoster('‚ö†Ô∏è Bu depo zaten mevcut!', 3000, 'error');
          return;
        }
        depolar.push(depoAdi);
        localStorage.setItem("depolar", JSON.stringify(depolar));
        localStorage.setItem(depoUrunKey(depoAdi), JSON.stringify([]));
        localStorage.setItem(depoVeriKey(depoAdi), JSON.stringify({}));
        localStorage.setItem(depoGecmisKey(depoAdi), JSON.stringify({}));
        localStorage.setItem(depoUyariKey(depoAdi), JSON.stringify({}));
        depoListesiniGuncelle();
        document.getElementById('depoEkleModal').classList.remove('active');
        document.getElementById('yeniDepoAdi').value = '';
        bildirimGoster(`‚úÖ ${depoAdi} deposu eklendi!`);
      });
      document.getElementById('urunEkleIptal').addEventListener('click', function() {
        document.getElementById('urunEkleModal').classList.remove('active');
      });
      document.getElementById('urunEkleKaydet').addEventListener('click', function() {
        const urunAdi = document.getElementById('yeniUrunAdi').value.trim();
        const urunMiktar = parseInt(document.getElementById('yeniUrunMiktar').value) || 0;
        let urunUyari = parseInt(document.getElementById('yeniUrunUyari').value);
        if (isNaN(urunUyari)) urunUyari = 1;
        if (!urunAdi) {
          bildirimGoster('‚ö†Ô∏è √úr√ºn adƒ± gerekli!', 3000, 'error');
          return;
        }
        const aktifUrunler = JSON.parse(localStorage.getItem(depoUrunKey(aktifDepo)) || "[]");
        if (aktifUrunler.includes(urunAdi)) {
          bildirimGoster('‚ö†Ô∏è Bu √ºr√ºn zaten mevcut!', 3000, 'error');
          return;
        }
        aktifUrunler.push(urunAdi);
        localStorage.setItem(depoUrunKey(aktifDepo), JSON.stringify(aktifUrunler));
        const kayitli = aktiveKayitliObj();
        kayitli[urunAdi] = urunMiktar;
        kaydetAktifKayitliObj(kayitli);
        setUyariMiktari(aktifDepo, urunAdi, urunUyari);
        if (urunMiktar > 0) {
          gecekmiseKaydet(urunAdi, 0, urunMiktar);
        }
        document.getElementById('urunEkleModal').classList.remove('active');
        document.getElementById('yeniUrunAdi').value = '';
        document.getElementById('yeniUrunMiktar').value = '0';
        document.getElementById('yeniUrunUyari').value = '';
        urunleriYukle();
        bildirimGoster(`‚úÖ ${urunAdi} √ºr√ºn√º eklendi!`);
      });
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          document.querySelectorAll('.modal-overlay.active').forEach(modal => {
            modal.classList.remove('active');
          });
          if (secimModu) {
            secimModunuAcKapat();
          }
        }
      });
      document.querySelectorAll('.modal-overlay').forEach(modal => {
        modal.addEventListener('click', function(e) {
          if (e.target === this) {
            this.classList.remove('active');
          }
        });
      });
      document.getElementById('gecmisAraBtn').addEventListener('click', function() {
        const urunAdi = document.getElementById('gecmisArama').value.trim();
        const listDiv = document.getElementById('gecmisListesi');
        if (!urunAdi) {
          listDiv.innerHTML = '<p style="text-align: center; color: #8e8e93;">L√ºtfen √ºr√ºn adƒ± girin</p>';
          return;
        }
        let tumGecmis = [];
        depolar.forEach(depoAd => {
          const depoGecmisi = JSON.parse(localStorage.getItem(depoGecmisKey(depoAd)) || "{}");
          if (depoGecmisi[urunAdi] && depoGecmisi[urunAdi].length > 0) {
            depoGecmisi[urunAdi].forEach(kayit => {
              tumGecmis.push({
                depo: depoAd,
                tarih: kayit.tarih,
                degisim: kayit.degisim,
                yeniMiktar: kayit.yeniMiktar
              });
            });
          }
        });
        if (tumGecmis.length === 0) {
          listDiv.innerHTML = `<p style="text-align: center; color: #8e8e93;">"${urunAdi}" √ºr√ºn√ºn√ºn ge√ßmi≈üi bulunamadƒ±</p>`;
          return;
        }
        tumGecmis.sort((a, b) => new Date(b.tarih.split(' ')[0].split('/').reverse().join('-')) - 
          new Date(a.tarih.split(' ')[0].split('/').reverse().join('-')));
        let html = '';
        tumGecmis.forEach(kayit => {
          const degisimIcon = kayit.degisim > 0 ? 'üìà' : 'üìâ';
          const degisimColor = kayit.degisim > 0 ? '#10b981' : '#ef4444';
          html += `
            <div class="gecmis-item">
              <div class="gecmis-tarih">${kayit.tarih} ‚Ä¢ ${kayit.depo}</div>
              <div class="gecmis-bilgi">
                <span style="color: ${degisimColor};">
                  ${degisimIcon} ${kayit.degisim > 0 ? '+' : ''}${kayit.degisim}
                </span>
                ‚Üí Yeni miktar: ${kayit.yeniMiktar}
              </div>
            </div>
          `;
        });
        listDiv.innerHTML = html;
      });
      document.getElementById('veriYedekleBtn').addEventListener('click', function() {
        const veri = {
          depolar: depolar,
          veriler: {}
        };
        depolar.forEach(depoAd => {
          veri.veriler[depoAd] = {
            urunler: JSON.parse(localStorage.getItem(depoUrunKey(depoAd)) || "[]"),
            miktarlar: JSON.parse(localStorage.getItem(depoVeriKey(depoAd)) || "{}"),
            gecmis: JSON.parse(localStorage.getItem(depoGecmisKey(depoAd)) || "{}"),
            uyarilar: JSON.parse(localStorage.getItem(depoUyariKey(depoAd)) || "{}")
          };
        });
        const veriStr = JSON.stringify(veri, null, 2);
        const blob = new Blob([veriStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `depo-yedek-${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        bildirimGoster('‚úÖ Veriler yedeklendi!');
      });
      document.getElementById('veriGeriYukleBtn').addEventListener('click', function() {
        if (!confirm('‚ö†Ô∏è Mevcut t√ºm verileriniz silinecek ve yedekten geri y√ºklenecek. Devam etmek istiyor musunuz?')) {
          return;
        }
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        input.onchange = function(e) {
          const file = e.target.files[0];
          const reader = new FileReader();
          reader.onload = function(e) {
            try {
              const yedek = JSON.parse(e.target.result);
              depolar = yedek.depolar || [];
              localStorage.setItem("depolar", JSON.stringify(depolar));
              localStorage.clear();
              if (yedek.veriler) {
                Object.keys(yedek.veriler).forEach(depoAd => {
                  localStorage.setItem(depoUrunKey(depoAd), JSON.stringify(yedek.veriler[depoAd].urunler || []));
                  localStorage.setItem(depoVeriKey(depoAd), JSON.stringify(yedek.veriler[depoAd].miktarlar || {}));
                  localStorage.setItem(depoGecmisKey(depoAd), JSON.stringify(yedek.veriler[depoAd].gecmis || {}));
                  localStorage.setItem(depoUyariKey(depoAd), JSON.stringify(yedek.veriler[depoAd].uyarilar || {}));
                });
              }
              depoListesiniGuncelle();
              ekranDegistir('depolar');
              bildirimGoster('‚úÖ Veriler ba≈üarƒ±yla geri y√ºklendi!');
            } catch(err) {
              bildirimGoster('‚ùå Ge√ßersiz yedek dosyasƒ±!', 3000, 'error');
            }
          };
          reader.readAsText(file);
        };
        input.click();
      });
      document.getElementById('yazdirRaporBtn').addEventListener('click', function() {
        raporlariGuncelle();
        let raporHTML = `
          <!DOCTYPE html>
          <html>
          <head>
            <title>Depo Takip - Rapor</title>
            <style>
              body { font-family: Arial, sans-serif; padding: 20px; }
              h1 { color: #3b82f6; }
              .rapor-section { margin-bottom: 30px; }
              table { width: 100%; border-collapse: collapse; margin-top: 10px; }
              th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
              th { background-color: #f8f9fa; }
              .kritik { background-color: #fef2f2; }
              .tarih { font-size: 12px; color: #666; margin-top: 20px; }
            </style>
          </head>
          <body>
            <h1>Depo Takip - Rapor</h1>
            <div class="tarih">Olu≈üturulma: ${new Date().toLocaleString('tr-TR')}</div>
        `;
        depolar.forEach(depoAd => {
          const depoUrunleri = JSON.parse(localStorage.getItem(depoUrunKey(depoAd)) || "[]");
          const depoVerileri = JSON.parse(localStorage.getItem(depoVeriKey(depoAd)) || "{}");
          const depoUyarilari = JSON.parse(localStorage.getItem(depoUyariKey(depoAd)) || "{}");
          if (depoUrunleri.length > 0) {
            raporHTML += `
              <div class="rapor-section">
                <h2>${depoAd} Deposu</h2>
                <table>
                  <thead>
                    <tr>
                      <th>√úr√ºn Adƒ±</th>
                      <th>Miktar</th>
                      <th>Uyarƒ± Seviyesi</th>
                      <th>Durum</th>
                    </tr>
                  </thead>
                  <tbody>
            `;
            depoUrunleri.forEach(urunAd => {
              const miktar = depoVerileri[urunAd] || 0;
              const uyariMiktari = depoUyarilari[urunAd] !== undefined ? depoUyarilari[urunAd] : 1;
              const durum = miktar <= uyariMiktari ? 'KRƒ∞Tƒ∞K' : 'NORMAL';
              const rowClass = miktar <= uyariMiktari ? 'kritik' : '';
              raporHTML += `
                <tr class="${rowClass}">
                  <td>${urunAd}</td>
                  <td>${miktar}</td>
                  <td>${uyariMiktari}</td>
                  <td>${durum}</td>
                </tr>
              `;
            });
            raporHTML += `
                  </tbody>
                </table>
              </div>
            `;
          }
        });
        raporHTML += `
          </body>
          </html>
        `;
        const printWindow = window.open('', '_blank');
        printWindow.document.write(raporHTML);
        printWindow.document.close();
        printWindow.focus();
        setTimeout(() => {
          printWindow.print();
          printWindow.close();
        }, 500);
        bildirimGoster('üìù Rapor yazdƒ±rma penceresi a√ßƒ±ldƒ±...');
      });
      document.getElementById('depoArama').addEventListener('input', function(e) {
        const aramaKelime = e.target.value.toLowerCase();
        const depoKartlari = document.querySelectorAll('.depo-card');
        depoKartlari.forEach(kart => {
          const depoAdi = kart.querySelector('.depo-name').textContent.toLowerCase();
          if (depoAdi.includes(aramaKelime)) {
            kart.style.display = 'flex';
          } else {
            kart.style.display = 'none';
          }
        });
      });
      document.getElementById('urunArama').addEventListener('input', function(e) {
        const aramaKelime = e.target.value.toLowerCase();
        const urunKartlari = document.querySelectorAll('.urun-card');
        urunKartlari.forEach(kart => {
          const urunAdi = kart.querySelector('.urun-name').textContent.toLowerCase();
          if (urunAdi.includes(aramaKelime)) {
            kart.style.display = 'block';
          } else {
            kart.style.display = 'none';
          }
        });
      });
      if (aktifDepo && depolar.includes(aktifDepo)) {
        depoAc();
      }
    });
  </script>
</body>
</html>